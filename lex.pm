my $TOKEN_DISPATCH = {
    'block' => {
        'EOF' => [undef],
        'EOL' => ['block'],
        'VERBATIM' => ['block', '_insert_verbatim'],
        'HRULE' => ['block', '_insert_hr'],
        'HEADING' => ['heading', '_start_h'],
        'JUSTLIST' => ['list', '_start_list'],
        'MAYBELIST' => ['paragraph', '_start_p', '_insert_phrase'],
        'TD' => ['table', '_start_table'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_start_list'],
        'DESC' => ['indent', '_start_indent', '_start_p'],
        'QUOTE' => ['indent', '_start_indent', '_start_p'],
        'SPACE' => ['block'],
        'PHRASE' => ['paragraph', '_start_p', '_insert_phrase'],
        'BREAK' => ['paragraph', '_start_p', '_insert_br'],
        'NOWIKI' => ['paragraph', '_start_p', '_insert_nowiki'],
        'BRACKETED' => ['paragraph', '_start_p', '_insert_bracketed'],
        'BRACED' => ['paragraph', '_start_p', '_insert_braced'],
        'PLACEHOLDER' => ['paragraph', '_start_p', '_insert_placeholder'],
        'PLUGIN' => ['paragraph', '_start_p', '_insert_plugin'],
        'FREESTAND' => ['paragraph', '_start_p', '_insert_freestand'],
        'ESCAPED' => ['paragraph', '_start_p', '_insert_escaped'],
        'TEXT' => ['paragraph', '_start_p', 'put'],
    },
    'paragraph' => {
        'EOF' => [undef, '_end_p'],
        'EOL' => ['paranext', 'puts'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['paragraph', 'put'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['paragraph', '_insert_phrase'],
        'TD' => ['paragraph', 'put'],
        'EOTD' => ['paragraph', 'put'],
        'TERM' => ['block'],
        'DESC' => ['paragraph', 'put'],
        'QUOTE' => ['block'],
        'SPACE' => ['paragraph', 'puts'],
        'PHRASE' => ['paragraph', '_insert_phrase'],
        'BREAK' => ['paragraph', '_insert_br'],
        'NOWIKI' => ['paragraph', '_insert_nowiki'],
        'BRACKETED' => ['paragraph', '_insert_bracketed'],
        'BRACED' => ['paragraph', '_insert_braced'],
        'PLACEHOLDER' => ['paragraph', '_insert_placeholder'],
        'PLUGIN' => ['paragraph', '_insert_plugin'],
        'FREESTAND' => ['paragraph', '_insert_freestand'],
        'ESCAPED' => ['paragraph', '_insert_escaped'],
        'TEXT' => ['paragraph', 'put'],
    },
    'paranext' => {
        'EOF' => [undef, '_end_p'],
        'EOL' => ['block', '_end_p'],
        'VERBATIM' => ['block', '_end_p', '_insert_verbatim'],
        'HRULE' => ['block', '_end_p', '_insert_hr'],
        'HEADING' => ['heading', '_end_p', '_start_h'],
        'JUSTLIST' => ['list', '_end_p', '_start_list'],
        'MAYBELIST' => ['paragraph', '_insert_phrase'],
        'TD' => ['table', '_end_p', '_start_table'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_end_p', '_start_list'],
        'DESC' => ['indent', '_end_p', '_start_indent', '_start_p'],
        'QUOTE' => ['indent', '_end_p', '_start_indent', '_start_p'],
        'SPACE' => ['paranext'],
        'PHRASE' => ['paragraph', '_insert_phrase'],
        'BREAK' => ['paragraph', '_insert_br'],
        'NOWIKI' => ['paragraph', '_insert_nowiki'],
        'BRACKETED' => ['paragraph', '_insert_bracketed'],
        'BRACED' => ['paragraph', '_insert_braced'],
        'PLACEHOLDER' => ['paragraph', '_insert_placeholder'],
        'PLUGIN' => ['paragraph', '_insert_plugin'],
        'FREESTAND' => ['paragraph', '_insert_freestand'],
        'ESCAPED' => ['paragraph', '_insert_escaped'],
        'TEXT' => ['paragraph', 'put'],
    },
    'heading' => {
        'EOF' => [undef, '_end_h'],
        'EOL' => ['block', '_end_h'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['block', '_end_h'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['heading', '_insert_phrase'],
        'TD' => ['heading', 'put'],
        'EOTD' => ['heading', 'put'],
        'TERM' => ['block'],
        'DESC' => ['heading', 'put'],
        'QUOTE' => ['block'],
        'SPACE' => ['heading', 'puts'],
        'PHRASE' => ['heading', '_insert_phrase'],
        'BREAK' => ['heading', '_insert_br'],
        'NOWIKI' => ['heading', '_insert_nowiki'],
        'BRACKETED' => ['heading', '_insert_bracketed'],
        'BRACED' => ['heading', '_insert_braced'],
        'PLACEHOLDER' => ['heading', '_insert_placeholder'],
        'PLUGIN' => ['heading', '_insert_plugin'],
        'FREESTAND' => ['heading', '_insert_freestand'],
        'ESCAPED' => ['heading', '_insert_escaped'],
        'TEXT' => ['heading', 'put'],
    },
    'list' => {
        'EOF' => [undef, '_end_list'],
        'EOL' => ['listnext', 'puts'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['list', 'put'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['list', '_insert_phrase'],
        'TD' => ['list', 'put'],
        'EOTD' => ['list', 'put'],
        'TERM' => ['block'],
        'DESC' => ['list', 'put'],
        'QUOTE' => ['block'],
        'SPACE' => ['list', 'puts'],
        'PHRASE' => ['list', '_insert_phrase'],
        'BREAK' => ['list', '_insert_br'],
        'NOWIKI' => ['list', '_insert_nowiki'],
        'BRACKETED' => ['list', '_insert_bracketed'],
        'BRACED' => ['list', '_insert_braced'],
        'PLACEHOLDER' => ['list', '_insert_placeholder'],
        'PLUGIN' => ['list', '_insert_plugin'],
        'FREESTAND' => ['list', '_insert_freestand'],
        'ESCAPED' => ['list', '_insert_escaped'],
        'TEXT' => ['list', 'put'],
    },
    'listnext' => {
        'EOF' => [undef, '_end_list'],
        'EOL' => ['block', '_end_list'],
        'VERBATIM' => ['block', '_end_list', '_insert_verbatim'],
        'HRULE' => ['block', '_end_list', '_insert_hr'],
        'HEADING' => ['heading', '_end_list', '_start_h'],
        'JUSTLIST' => ['list', '_insert_list'],
        'MAYBELIST' => ['list', '_insert_list'],
        'TD' => ['table', '_end_list', '_start_table'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_insert_list'],
        'DESC' => ['list', '_insert_list'],
        'QUOTE' => ['indent', '_end_list', '_start_indent', '_start_p'],
        'SPACE' => ['listnext'],
        'PHRASE' => ['list', '_insert_phrase'],
        'BREAK' => ['list', '_insert_br'],
        'NOWIKI' => ['list', '_insert_nowiki'],
        'BRACKETED' => ['list', '_insert_bracketed'],
        'BRACED' => ['list', '_insert_braced'],
        'PLACEHOLDER' => ['list', '_insert_placeholder'],
        'PLUGIN' => ['list', '_insert_plugin'],
        'FREESTAND' => ['list', '_insert_freestand'],
        'ESCAPED' => ['list', '_insert_escaped'],
        'TEXT' => ['list', 'put'],
    },
    'table' => {
        'EOF' => [undef, '_end_table'],
        'EOL' => ['tablenext'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['table', 'put'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['table', '_insert_phrase'],
        'TD' => ['table', '_insert_td'],
        'EOTD' => ['tdnext'],
        'TERM' => ['block'],
        'DESC' => ['table', 'put'],
        'QUOTE' => ['block'],
        'SPACE' => ['table', 'puts'],
        'PHRASE' => ['table', '_insert_phrase'],
        'BREAK' => ['table', '_insert_br'],
        'NOWIKI' => ['table', '_insert_nowiki'],
        'BRACKETED' => ['table', '_insert_bracketed'],
        'BRACED' => ['table', '_insert_braced'],
        'PLACEHOLDER' => ['table', '_insert_placeholder'],
        'PLUGIN' => ['table', '_insert_plugin'],
        'FREESTAND' => ['table', '_insert_freestand'],
        'ESCAPED' => ['table', '_insert_escaped'],
        'TEXT' => ['table', 'put'],
    },
    'tdnext' => {
        'EOF' => [undef, '_end_table'],
        'EOL' => ['tablenext'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['block'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['block'],
        'TD' => ['block'],
        'EOTD' => ['block'],
        'TERM' => ['block'],
        'DESC' => ['block'],
        'QUOTE' => ['block'],
        'SPACE' => ['block'],
        'PHRASE' => ['block'],
        'BREAK' => ['block'],
        'NOWIKI' => ['block'],
        'BRACKETED' => ['block'],
        'BRACED' => ['block'],
        'PLACEHOLDER' => ['block'],
        'PLUGIN' => ['block'],
        'FREESTAND' => ['block'],
        'ESCAPED' => ['block'],
        'TEXT' => ['block'],
    },
    'tablenext' => {
        'EOF' => [undef, '_end_table'],
        'EOL' => ['block', '_end_table'],
        'VERBATIM' => ['block', '_end_table', '_insert_verbatim'],
        'HRULE' => ['block', '_end_table', '_insert_hr'],
        'HEADING' => ['heading', '_end_table', '_start_h'],
        'JUSTLIST' => ['list', '_end_table', '_start_list'],
        'MAYBELIST' => ['paragraph', '_end_table', '_start_p', '_insert_phrase'],
        'TD' => ['table', '_insert_tr'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_end_table', '_start_list'],
        'DESC' => ['indent', '_end_table', '_start_indent', '_start_p'],
        'QUOTE' => ['indent', '_end_table', '_start_indent', '_start_p'],
        'SPACE' => ['tablenext'],
        'PHRASE' => ['paragraph', '_end_table', '_start_p', '_insert_phrase'],
        'BREAK' => ['paragraph', '_end_table', '_start_p', '_insert_br'],
        'NOWIKI' => ['paragraph', '_end_table', '_start_p', '_insert_nowiki'],
        'BRACKETED' => ['paragraph', '_end_table', '_start_p', '_insert_bracketed'],
        'BRACED' => ['paragraph', '_end_table', '_start_p', '_insert_braced'],
        'PLACEHOLDER' => ['paragraph', '_end_table', '_start_p', '_insert_placeholder'],
        'PLUGIN' => ['paragraph', '_end_table', '_start_p', '_insert_plugin'],
        'FREESTAND' => ['paragraph', '_end_table', '_start_p', '_insert_freestand'],
        'ESCAPED' => ['paragraph', '_end_table', '_start_p', '_insert_escaped'],
        'TEXT' => ['paragraph', '_end_table', '_start_p', 'put'],
    },
    'indent' => {
        'EOF' => [undef, '_end_p', '_end_indent'],
        'EOL' => ['indentnext', 'puts'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['indent', 'put'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['indent', '_insert_phrase'],
        'TD' => ['indent', 'put'],
        'EOTD' => ['indent', 'put'],
        'TERM' => ['block'],
        'DESC' => ['indent', 'put'],
        'QUOTE' => ['block'],
        'SPACE' => ['indent', 'puts'],
        'PHRASE' => ['indent', '_insert_phrase'],
        'BREAK' => ['indent', '_insert_br'],
        'NOWIKI' => ['indent', '_insert_nowiki'],
        'BRACKETED' => ['indent', '_insert_bracketed'],
        'BRACED' => ['indent', '_insert_braced'],
        'PLACEHOLDER' => ['indent', '_insert_placeholder'],
        'PLUGIN' => ['indent', '_insert_plugin'],
        'FREESTAND' => ['indent', '_insert_freestand'],
        'ESCAPED' => ['indent', '_insert_escaped'],
        'TEXT' => ['indent', 'put'],
    },
    'indentnext' => {
        'EOF' => [undef, '_end_p', '_end_indent'],
        'EOL' => ['block', '_end_p', '_end_indent'],
        'VERBATIM' => ['block', '_end_p', '_end_indent', '_insert_verbatim'],
        'HRULE' => ['block', '_end_p', '_end_indent', '_insert_hr'],
        'HEADING' => ['heading', '_end_p', '_end_indent', '_start_h'],
        'JUSTLIST' => ['list', '_end_p', '_end_indent', '_start_list'],
        'MAYBELIST' => ['indentnext', '_insert_phrase'],
        'TD' => ['table', '_end_p', '_end_indent', '_start_table'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_end_p', '_end_indent', '_start_list'],
        'DESC' => ['indent', '_end_p', '_insert_indent', '_start_p'],
        'QUOTE' => ['indent', '_end_p', '_insert_indent', '_start_p'],
        'SPACE' => ['indentnext'],
        'PHRASE' => ['indent', '_insert_phrase'],
        'BREAK' => ['indent', '_insert_br'],
        'NOWIKI' => ['indent', '_insert_nowiki'],
        'BRACKETED' => ['indent', '_insert_bracketed'],
        'BRACED' => ['indent', '_insert_braced'],
        'PLACEHOLDER' => ['indent', '_insert_placeholder'],
        'PLUGIN' => ['indent', '_insert_plugin'],
        'FREESTAND' => ['indent', '_insert_freestand'],
        'ESCAPED' => ['indent', '_insert_escaped'],
        'TEXT' => ['indent', 'put'],
    },
    'term' => {
        'EOF' => [undef, '_end_list'],
        'EOL' => ['termnext', 'puts'],
        'VERBATIM' => ['block'],
        'HRULE' => ['block'],
        'HEADING' => ['term', 'put'],
        'JUSTLIST' => ['block'],
        'MAYBELIST' => ['term', '_insert_phrase'],
        'TD' => ['term', 'put'],
        'EOTD' => ['term', 'put'],
        'TERM' => ['block'],
        'DESC' => ['list', '_insert_colon'],
        'QUOTE' => ['block'],
        'SPACE' => ['term', 'puts'],
        'PHRASE' => ['term', '_insert_phrase'],
        'BREAK' => ['term', '_insert_br'],
        'NOWIKI' => ['term', '_insert_nowiki'],
        'BRACKETED' => ['term', '_insert_bracketed'],
        'BRACED' => ['term', '_insert_braced'],
        'PLACEHOLDER' => ['term', '_insert_placeholder'],
        'PLUGIN' => ['term', '_insert_plugin'],
        'FREESTAND' => ['term', '_insert_freestand'],
        'ESCAPED' => ['term', '_insert_escaped'],
        'TEXT' => ['term', 'put'],
    },
    'termnext' => {
        'EOF' => [undef, '_end_list'],
        'EOL' => ['block', '_end_list'],
        'VERBATIM' => ['block', '_end_list', '_insert_verbatim'],
        'HRULE' => ['block', '_end_list', '_insert_hr'],
        'HEADING' => ['heading', '_end_list', '_start_h'],
        'JUSTLIST' => ['list', '_insert_list'],
        'MAYBELIST' => ['list', '_insert_list'],
        'TD' => ['table', '_end_list', '_start_table'],
        'EOTD' => ['block'],
        'TERM' => ['term', '_insert_list'],
        'DESC' => ['list', '_insert_list'],
        'QUOTE' => ['indent', '_end_list', '_start_indent', '_start_p'],
        'SPACE' => ['termnext'],
        'PHRASE' => ['term', '_insert_phrase'],
        'BREAK' => ['term', '_insert_br'],
        'NOWIKI' => ['term', '_insert_nowiki'],
        'BRACKETED' => ['term', '_insert_bracketed'],
        'BRACED' => ['term', '_insert_braced'],
        'PLACEHOLDER' => ['term', '_insert_placeholder'],
        'PLUGIN' => ['term', '_insert_plugin'],
        'FREESTAND' => ['term', '_insert_freestand'],
        'ESCAPED' => ['term', '_insert_escaped'],
        'TEXT' => ['term', 'put'],
    },
};
